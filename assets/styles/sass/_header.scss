@use 'mixins' as *;
@use 'sass:map';

.site-header {
  --_padding-block: calc(var(--site-padding-inline) * 2 / 3);
  inline-size: 100%;
  block-size: var(--header-block-size);
  background: var(--clr-site-bg);
  padding: var(--_padding-block) var(--site-padding-inline);
  position: relative;
  isolation: isolate;
  display: flex;
  justify-content: space-between;
  align-items: center;

  a:not(.btn) {
    color: currentColor;
    text-decoration: none;
  }

  @at-root .site-title {
    block-size: 100%;
    position: relative;
    z-index: 999;
  
    a {
      display: inline-block;
      block-size: 100%;
    }
  
    svg {
      block-size: 100%;
    }

    &:has(~ .site-nav-toggle[aria-expanded='true']) {
      svg > g {
        *, * g {
          fill: #fff !important;
        }
      }
    }
  }

  .skip-nav {
    position: absolute;
    inset: auto auto 0 var(--site-padding-inline);
    translate: 0 100%;
  }

  .site-nav-toggle {
    svg {
      --_size: 2rem;
      --_line-height: 1.2px;
      width: var(--_size);
      height: var(--_size);
      display: block;
      position: relative;
      z-index: 999;

      rect {
        --_anim_time_1: .25s;
        --_anim_time_2: .2s;
        fill: currentColor;
        width: 10px;
        height: var(--_line-height);
        rx: calc(var(--_line-height) / 2);
        transition:
          rotate var(--_anim_time_2) ease,
          y var(--_anim_time_1) ease var(--_anim_time_2),
          width 0s linear var(--_anim_time_2);
        transform-origin: center center;
      
        &:nth-child(1) {
          y: 0px;
        }
      
        &:nth-child(2) {
          x: 2px;
          width: 8px;
          y: calc(5px - var(--_line-height) * 0.5);
        }
      
        &:nth-child(3) {
          y: calc(10px - var(--_line-height));
        }
      }
    }

    &[aria-expanded='true'] {
      svg rect {
        fill: #fff !important;
        transition:
          rotate var(--_anim_time_1) ease var(--_anim_time_2),
          y var(--_anim_time_1) ease,
          width 0s linear var(--_anim_time_1);

        &:nth-child(1) {
          y: calc(5px - var(--_line-height) * 0.5);
          rotate: -45deg;
        }
        &:nth-child(2) {
          width: 0;
        }
        &:nth-child(3) {
          y: calc(5px - var(--_line-height) * 0.5);
          rotate: 45deg;
        }
      }
    }
  }
}

.site-nav {
  --_border-radius: .75em;
  --_inset: calc(var(--site-padding-inline) / 2);
  --_padding-inline: var(--site-padding-inline);
  position: absolute;
  inset: var(--_inset) var(--_inset) auto;
  background: hsl(0 0% 0% / 85%);
  border-radius: .5rem;
  padding-block-start: var(--header-block-size);
  color: #fff;
  max-block-size: calc(100vh - var(--_inset) * 2);
  overflow: hidden;

  li {
    list-style: none;
    position: relative;

    &:where([aria-current], :has([aria-current])) > :where(a, button) {
      color: pink;
    }

    & > :where(a, button) {
      display: block;
      inline-size: 100%;
      text-align: start;
      padding: calc(var(--_padding-inline) / 2) var(--_padding-block);

      &:where(:hover, :focus-visible) {
        background: var(--clr-light-accent-200);
        outline: none;
      }
    }

    & > button[aria-haspopup='true'] {
      @extend .bi;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      column-gap: 1ch;
      flex-direction: row-reverse;

      &::before {
        content: map.get($bootstrap-icons-map, 'chevron-down');
        transform: rotate .25s ease;
      }
      
      &[aria-expanded='true']::before {
        rotate: -180deg;
      }
    }

    ul {
      block-size: 0;
      overflow: hidden;
      padding: 0;
    }
  }
}

