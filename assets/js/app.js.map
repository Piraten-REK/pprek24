{"version":3,"file":"app.js","sources":["../ts/lib/aria.ts","../ts/lib/menu.ts","../ts/app.ts"],"sourcesContent":["export type BoolString = 'true' | 'false'\n\ntype AnyElement = HTMLElement | SVGElement\n\ndeclare global {\n  interface Boolean {\n    toString: () => BoolString\n  }\n}\n\nexport enum AriaAttributes {\n  ARIA_CONTROLS = 'aria-controls',\n  ARIA_EXPANDED = 'aria-expanded',\n  ARIA_HASPOPUP = 'aria-haspopup'\n}\n\nexport function toggleExpanded (element: AnyElement): BoolString {\n  const current = element.getAttribute(AriaAttributes.ARIA_EXPANDED) === 'true'\n  const newValue = (!current).toString()\n\n  element.setAttribute(AriaAttributes.ARIA_EXPANDED, newValue)\n\n  return newValue\n}\n\nexport function getExpanded (element: AnyElement): boolean {\n  return Boolean(element.getAttribute(AriaAttributes.ARIA_EXPANDED))\n}\n\nexport function setExpanded (element: AnyElement, value: BoolString | boolean): void {\n  element.setAttribute(AriaAttributes.ARIA_EXPANDED, value.toString())\n}\n","import { AriaAttributes, setExpanded, toggleExpanded } from './aria'\n\ntype MenuStructure = Array<\n| {\n  type: 'item'\n  element: HTMLElement\n  list: HTMLUListElement\n  toggle: HTMLButtonElement\n}\n| {\n  type: 'toggle'\n  element: HTMLButtonElement\n  list: HTMLUListElement\n  items: MenuStructure\n}\n>\n\nfunction getNearestFocusable (element: HTMLElement, tags: string[] = ['li', '*'], depth: number = 0, arr: HTMLElement[] = []): HTMLElement[] {\n  if (depth >= tags.length) {\n    return arr\n  }\n\n  for (\n    let idx = 0, child = element.children[0] as HTMLElement;\n    idx < element.children.length;\n    child = element.children[++idx] as HTMLElement\n  ) {\n    if (tags[depth] === '*' || child.tagName.toLowerCase() === tags[depth].toLowerCase()) {\n      if (depth === tags.length - 1) {\n        if (child.getAttribute('tabindex') === '-1') {\n          arr.push(child)\n        }\n      }\n\n      getNearestFocusable(child, tags, depth + 1, arr)\n    }\n  }\n\n  return arr\n}\n\nexport function setUpMenuStructure (menu: HTMLUListElement, toggle: HTMLButtonElement): MenuStructure {\n  const structure: MenuStructure = []\n\n  for (const item of getNearestFocusable(menu)) {\n    const hasPopup = item.getAttribute(AriaAttributes.ARIA_HASPOPUP)\n    if (hasPopup != null && hasPopup !== 'false') {\n      const controls = item.getAttribute(AriaAttributes.ARIA_CONTROLS)\n\n      if (controls == null) {\n        throw new Error()\n      }\n\n      const subMenu: HTMLUListElement | null = menu.querySelector(`#${controls}`)\n\n      if (subMenu == null) {\n        throw new Error()\n      }\n\n      structure.push({\n        type: 'toggle',\n        element: item as HTMLButtonElement,\n        list: subMenu,\n        items: setUpMenuStructure(subMenu, item as HTMLButtonElement)\n      })\n    } else {\n      structure.push({\n        type: 'item',\n        element: item,\n        list: menu,\n        toggle\n      })\n    }\n  }\n\n  return structure\n}\n\nfunction getStructureAt (structure: MenuStructure, indices: number[]): MenuStructure {\n  const _indices = Array.from(indices)\n  const index = _indices.shift() as number\n  const subStructure = structure.at(index) as MenuStructure[number]\n\n  if (_indices.length > 0) {\n    return getStructureAt(\n      (subStructure as Extract<MenuStructure[number], { type: 'toggle' }>).items,\n      _indices\n    )\n  } else {\n    return structure\n  }\n}\n\nfunction setClickHandlers (structure: MenuStructure, currentIndex: number[], depth: number = 0): void {\n  for (\n    let idx = 0, entry = structure[0];\n    idx < structure.length;\n    entry = structure[++idx]\n  ) {\n    if (entry.type === 'item') {\n      continue\n    }\n\n    entry.element.addEventListener('click', () => {\n      const state = toggleExpanded(entry.element)\n\n      currentIndex[depth] = idx\n\n      if (state === 'true') {\n        entry.items[0].element.focus()\n        currentIndex[depth + 1] = 0\n      } else {\n        entry.element.focus()\n      }\n    })\n\n    setClickHandlers(entry.items, currentIndex, depth + 1)\n  }\n}\n\nexport default function setUpMenu (menu: HTMLUListElement, toggle: HTMLButtonElement): void {\n  const structure = setUpMenuStructure(menu, toggle)\n  const currentIndex: number[] = []\n\n  toggle.addEventListener('click', () => {\n    const state = toggleExpanded(toggle)\n\n    if (state === 'true') {\n      structure[0].element.focus()\n      currentIndex[0] = 0\n    } else {\n      toggle.focus()\n      delete currentIndex[0]\n    }\n  })\n\n  setClickHandlers(structure, currentIndex)\n\n  menu.addEventListener('keydown', event => {\n    const current = getStructureAt(structure, currentIndex)\n\n    if ((event.key === 'Tab' && !event.shiftKey) || event.key === 'ArrowDown') {\n      event.preventDefault()\n      const newIndex = ((currentIndex.at(-1) as number) + 1) % current.length\n      current[newIndex].element.focus()\n      currentIndex[currentIndex.length - 1] = newIndex\n    } else if ((event.key === 'Tab' && event.shiftKey) || event.key === 'ArrowUp') {\n      event.preventDefault()\n      const newIndex = ((currentIndex.at(-1) as number) + current.length - 1) % current.length\n      current[newIndex].element.focus()\n      currentIndex[currentIndex.length - 1] = newIndex\n    } else if (event.key === 'Enter' || event.code === 'Space') {\n      const currentItem = current[currentIndex.at(-1) as number]\n      if (currentItem.type === 'toggle') {\n        event.preventDefault()\n        setExpanded(currentItem.element, true)\n        currentItem.items[0].element.focus()\n        currentIndex.push(0)\n      }\n    } else if (event.key === 'Escape') {\n      event.preventDefault()\n      if (currentIndex.length === 1) {\n        toggle.focus()\n        setExpanded(toggle, false)\n        delete currentIndex[0]\n      } else {\n        const parentStructure = getStructureAt(structure, currentIndex.slice(0, -1))\n        const parent = parentStructure[currentIndex.at(-2) as number]\n        parent.element.focus()\n        setExpanded(parent.element, false)\n        currentIndex.pop()\n      }\n    } else if (event.key === 'ArrowRight') {\n      event.preventDefault()\n      const currentItem = current[currentIndex.at(-1) as number]\n      if (currentItem.type === 'toggle') {\n        setExpanded(currentItem.element, true)\n        currentItem.items[0].element.focus()\n        currentIndex.push(0)\n      }\n    } else if (event.key === 'ArrowLeft') {\n      event.preventDefault()\n      if (currentIndex.length > 1) {\n        const parentStructure = getStructureAt(structure, currentIndex.slice(0, -1))\n        const parent = parentStructure[currentIndex.at(-2) as number]\n        parent.element.focus()\n        setExpanded(parent.element, false)\n        currentIndex.pop()\n      }\n    }\n  })\n}\n","import setUpMenu from './lib/menu'\n\nconst siteNav = document.querySelector('.site-nav') as HTMLUListElement\nconst siteNavToggle = document.querySelector('.site-nav-toggle') as HTMLButtonElement\nsetUpMenu(siteNav, siteNavToggle)\n"],"names":[],"mappings":"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"}